<!DOCTYPE html>
<html>
<head>
	<title>Ball Blaster</title>
  <link rel='stylesheet' href='https://use.fontawesome.com/releases/v5.7.0/css/all.css' integrity='sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ' crossorigin='anonymous'>
  <link href="https://fonts.googleapis.com/css?family=Cute+Font&display=swap" rel="stylesheet">
	<style type="text/css">
		<style type="text/css">
		*{
			margin: 0;
			padding: 0;
		}
    p{
      position: absolute;
      }
   button{
    position: absolute;
   }   
		#canvas {
  width: 850px;
  height: 653px;
  border: 1px solid black;
  position: absolute;
  right: 20%;
  top: 0px;
  display: none;
}
#index{
  width: 600px;
  height: 653px;
  border: 1px solid black;
  position: absolute;
  right: 30%;
  top: 0px;
}
       #title{
          font-family: 'Cute Font', cursive;
          font-size: 100px;
          top: 40px;
          left: 120px;
      }
       #des{
          font-family: 'Cute Font', cursive;
          font-size: 50px;
          top: 220px;
          left: 70px;
      }
      #name{
              top: 380px;
              height: 34px;
              border-radius: 5px 5px 5px 5px;
              border-style: solid;
              border-width: 1px;
              border-color: #BDC7D8;
              position: absolute;
              width:320px;
              height: 20px;
              font-size: 18px;
              padding: 10px;
              left: 120px;  
      }
       #butt{
            border-radius: 5px 5px 5px 5px;
            color:white;
            background-color: #619F4E;
            font-weight: bold;
            width:200px;
            height:40px;
            left:180px;
            top:490px;
            position: absolute;
            border-color: #3B6E22;
            border-width: 1px;
            box-sizing: border-box;
            font-size: 20px;
            font-family: Helvetica;
            cursor: pointer;
      }
	</style>
</head>
<body>
<div id="index">
  <p id="title">Ball Blaster</p>
  <p id="des">Enter your name to play Game !!</p>
  <input type="text" name="name" id="name" placeholder="Enter Your Name">
  <button id="butt" onclick="start()">PLAY</button>

</div>
<canvas id="canvas"></canvas>
<script type="text/javascript">
	var c=document.getElementById('canvas').getContext("2d");
	function makeSquare(x, y, length, speed) {
  return {
    x: x,
    y: y,
    w: length,
    h:length,
    s: speed,
    draw: function() {
      c.fillRect(this.x, this.y, this.w, this.h);
    }
  };}
  function makeenemy(x,y,radius,speedx,speedy,strength){
    return{
      x:x,
      y:y,
      r:radius,
      sx:speedx,
      sy:speedy,
      num:strength,
      num2:strength,
     
      draw: function(){
        c.beginPath();
        c.arc(this.x,this.y,this.r,0,2*Math.PI,true);
        c.fill();
        c.fillStyle="#FFFFFF";
        c.font = '10px Arial';
        c.fillText(this.num,this.x-6,this.y+3);
      }
    }
  }
  function makearrayenemy(){
    if (Math.floor(Math.random() * 2)) {
      var enemyX=0;
    }else{
      var enemyX=canvas.width;
    }
    var enemysize=10;
    var enemyY=Math.floor(Math.random() * (3*canvas.height/4));
    var enemyspeedx=1;
    var enemyspeedy=1;
    var strength=Math.floor(Math.random() * 50);
    enemies.push(makeenemy(enemyX,enemyY,enemysize,enemyspeedx,enemyspeedy,strength));
  }
  function maketank(x,y,w,h){
    return{
      x:x,
      y:y,
      w:w,
      h:h,
      draw:function(){
      c.drawImage(img,this.x,this.y,this.w,this.h);
    }
    };
  }
   var img=new Image();
   img.src="tanks.png";

  var tank=maketank(canvas.width/2,canvas.height-30,30,30);
  var bullet = makeSquare(0,0, 5, 7);
  var shooting = false;
  var right = false;
  var left = false;
  var space=false;
  var enemies=[];
  var time;
  var timegap=10000;
  var name;
  var score=0;
  var arscore=[];
  document.addEventListener("keydown", keyDownHandler, false);
document.addEventListener("keyup", keyUpHandler, false);
 function keyDownHandler(e) {
    if(e.key == "Right" || e.key == "ArrowRight") {
        right = true;
    }
    else if(e.key == "Left" || e.key == "ArrowLeft") {
        left = true;
    }
    if (e.keyCode == 32) { // SPACE
         shoot();   
  }
}

function keyUpHandler(e) {
    if(e.key == "Right" || e.key == "ArrowRight") {
        right = false;
    }
    else if(e.key == "Left" || e.key == "ArrowLeft") {
        left = false;
    }
}
function shoot() {
  if (!shooting) {
    shooting = true;
    bullet.x = tank.x + tank.w/2;
    bullet.y = tank.y + tank.h ;
  }
}

function isWithin(a, b, c) {
  return (a > b && a < c);
}
function isColliding(a, b) {
  var result = false;
  if (isWithin(a.x, (b.x-b.r), (b.x + b.r)) || isWithin(a.x + a.w, (b.x-b.r), (b.x + b.r))) {
    if (isWithin(a.y, b.y-b.r, b.y + b.r) || isWithin(a.y + a.h, b.y-b.r, b.y + b.r)) {
      result = true;
    }
  }
  return result;
}

function draw(){ 
   
  var gameover=false;
	c.clearRect(0,0,canvas.width,canvas.height);
  enemies.forEach(function(enemy){
    enemy.x+=enemy.sx;
    enemy.y+=enemy.sy;
    if (enemy.x<0||enemy.x>(enemy.r+canvas.width)) {
      enemy.sx=-enemy.sx;
    }
    if (enemy.y<0||enemy.y>(enemy.r+canvas.height) ){
      enemy.sy=-enemy.sy;
    }
      c.fillStyle = '#00FF00';
      enemy.draw();
  });
  enemies.forEach(function(enemy, i) {
    if (isColliding(tank,enemy)) {
      gameover = true;
        if (localStorage.length==0) {
          var arr=[];
          arr.push({nam:name,sc:score});
          localStorage.setItem('sta', JSON.stringify(arr));
        }else
        {
          var arr=JSON.parse(localStorage.getItem('sta'));
          arr.push({nam:name,sc:score});
           localStorage.setItem('sta', JSON.stringify(arr));
        }
            
    }
  });
	if(right){
		tank.x+=tank.s;
	}
	if(left){
		tank.x-=tank.s;
	}
	if (tank.x<0) {
		tank.x=0;
	}
	if(tank.x>(canvas.width-tank.w)){
		tank.x=canvas.width-tank.w;
	}
  c.fillStyle="#000000";
  tank.draw();
	if (shooting) {
		bullet.y-=bullet.s;
    enemies.forEach(function(enemy,i){
      if(isColliding(bullet,enemy)){
          if(enemy.num>1){enemy.num--;}
          else{
           
               var enemyX=enemy.x;
               var enemyspeedx=1;
               var enemyY=enemy.y;
               var enemyspeedy=1;
               var enemysize=10;
               if(enemy.num%2==0){
               var strength=enemy.num2/2;}
               else{
                var strength=(enemy.num2+1)/2;
               }
               if(strength!=0){
              enemies.push(makeenemy(enemyX,enemyY,enemysize,enemyspeedx,enemyspeedy,strength));
              enemies.push(makeenemy(enemyX,enemyY,enemysize,-enemyspeedx,enemyspeedy,strength));
            }
            enemies.splice(i,1);
            }
          shooting=false;
          score++;
          bullet.s+=0.25;
      }
    });
	
	  if (bullet.y < 0 ) {
      shooting = false;
    } 
    c.fillStyle="#000000";
    bullet.draw();
}
  c.fillStyle = '#000000';
  c.font = '10px Bradley Hand ITC';
  c.textAlign = 'left';
  c.fillText('Score: ' + score, 1, 7);
	if(gameover){
    gameover1();
  }
  else{
     window.requestAnimationFrame(draw);
  }
}

function startgame(){
     time= setInterval(makearrayenemy, timegap);
     draw();
}
function gameover1(){
   c.clearRect(0,0,canvas.width,canvas.height);
   clearInterval(time);
    c.font="30px Bradley Hand ITC";
  c.fillStyle="#000000";
   c.fillText("Game Over!",70,40);
   c.font="20px Bradley Hand ITC"
   c.fillText("Scorboard",100,60);
  
  c.font="15px Bradley Hand ITC";
   arscore=JSON.parse(localStorage.getItem('sta'));
  arscore.sort(function(b,a){return a.sc-b.sc});
  
    x=80;
    dx=12.5;
  for( i=0;i<6;i++){
    c.fillText((i+1)+"."+arscore[i].nam+" : "+arscore[i].sc,10,x);
    x=x+dx;
  }
}
function start(){
  img.onload=function()
{   name=document.getElementById("name").value;
   if(name.length>=10||name.length==0){
    alert("Enter some name with less than 10 letter");
   }else{
    document.getElementById("index").style.display="none";
    document.getElementById("canvas").style.display="inline-block";
    startgame();
   }
 }  
}

canvas.focus();
</script>
</body>
</html>